name: mainãƒ–ãƒ©ãƒ³ãƒã®å†…å®¹ã‚’ã‚‚ã¨ã«æœ¬ç•ªç’°å¢ƒAPIã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

on:
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
  ssh:
    runs-on: ubuntu-latest
    environment:
      name: "æœ¬ç•ªç’°å¢ƒAPI"
      url: https://api.seiryofes.com/docs
    steps:
      - name: ðŸ”‘Loading ssh private key...
        run: |
          mkdir -p .ssh && chmod 700 .ssh
          echo "$SSH_KEY" > .ssh/id_rsa && chmod 600 .ssh/id_rsa
        env:
          SSH_KEY: ${{ secrets.SSH_PRIVATEKEY }}
      - name: ðŸš€Deploy!!
        run: |
          ssh -t -t -o "StrictHostKeyChecking=no" -i .ssh/id_rsa $HOST "
            cd $QUAINT_REPO_PATH
            git checkout main
            git pull
            docker-compose down
            docker-compose -f docker-compose-app.yml up -d --build
          "
        env:
          HOST: ${{ secrets.SSH_HOST }}
          QUAINT_REPO_PATH: ${{ secrets.QUAINT_REPO_PATH }}
